# Author: Omar Abdeldayem
# Workflow: Animated Contribution Graph Generator
# Description: Creates and updates a contribution graph animation showing a snake consuming your commits.

name: Contribution Snake Generator

on:
  # Run automatically every 6 hours
  schedule:
    - cron: "0 */6 * * *"
  
  # Allow manual triggering from the GitHub Actions tab
  workflow_dispatch:

jobs:
  generate-snake:
    # Use the latest Ubuntu runner
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository content
      - name: Retrieve repository data
        uses: actions/checkout@v4

      # Step 2: Generate the contribution snake animation
      - name: Create contribution animation
        uses: Platane/snk@master
        id: create-snake
        with:
          github_user_name: OmarAbdeldayem
          # Save the generated files to a dedicated directory
          gif_out_path: dist/contribution-snake.gif
          svg_out_path: dist/contribution-snake.svg

      # Step 3: Display repository status (useful for troubleshooting)
      - name: Display repository status
        run: git status

      # Step 4: Commit and push generated animation to GitHub
      - name: Push generated animation
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
          force: true

      # Step 5: Deploy the animation to the output branch for hosting
      - name: Deploy animation to GitHub Pages
        uses: crazy-max/ghaction-github-pages@v2.1.3
        with:
          target_branch: output
          build_dir: dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
